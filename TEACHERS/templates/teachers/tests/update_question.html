{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">Savolni tahrirlash</h3>

  <form method="post" enctype="multipart/form-data" class="p-4 shadow-sm bg-light rounded">
    {% csrf_token %}
    
    <div class="mb-3">
      {{ form.non_field_errors }}
      {{ form.text.label_tag }} {{ form.text }}
    </div>

    <div class="mb-3">
      {{ form.image.label_tag }} {{ form.image }}
    </div>

    <div class="mb-3">
      {{ form.warning.label_tag }} {{ form.warning }}
    </div>

    <hr>
    <h5 class="mt-4">Variantlar</h5>
    <div id="formset">
      {{ formset.management_form }}
      {% for form in formset %}
        <div class="formset-item mb-3 border p-3 rounded bg-white position-relative">
          {% for hidden in form.hidden_fields %}
            {{ hidden }}
          {% endfor %}

          <div class="row g-3">
            <div class="col-md-6">
              {{ form.text.label_tag }} {{ form.text }}
            </div>
            <div class="col-md-4">
              {{ form.image.label_tag }} {{ form.image }}
            </div>
            <div class="col-md-2 text-end">
              <label>&nbsp;</label><br>
              {{ form.is_correct }}
              <span class="small">To'g'ri</span>
            </div>
          </div>

          {% if form.instance.pk %}
            <div class="form-check mt-2">
              {{ form.DELETE }} <label class="form-check-label">O'chirish</label>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-success">Saqlash</button>
  </form>

  <style>
    input[type="text"], textarea, select {
      width: 100%;
      padding: 6px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .formset-item {
      margin-bottom: 15px;
    }

    .btn-success {
      margin-top: 20px;
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let totalForms = document.getElementById('id_form-TOTAL_FORMS');
      const formsetDiv = document.getElementById('formset');
      const addBtn = document.createElement('button');
      addBtn.textContent = "Variant qoâ€˜shish";
      addBtn.type = "button";
      addBtn.classList.add("btn", "btn-secondary", "mt-3");
      formsetDiv.appendChild(addBtn);
  
      addBtn.addEventListener("click", function () {
        const currentFormCount = parseInt(totalForms.value);
        const emptyFormHtml = formsetDiv.querySelector('.formset-item').cloneNode(true);
  
        // Tozalash
        emptyFormHtml.querySelectorAll('input, textarea').forEach(input => {
          if (input.type === "checkbox") {
            input.checked = false;
          } else {
            input.value = "";
          }
        });
  
        // Form nomlarini yangilash
        emptyFormHtml.innerHTML = emptyFormHtml.innerHTML.replace(/form-(\d)+-/g, `form-${currentFormCount}-`);
        formsetDiv.insertBefore(emptyFormHtml, addBtn);
        totalForms.value = currentFormCount + 1;
      });
    });
  </script>
  
</div>
{% endblock %}
